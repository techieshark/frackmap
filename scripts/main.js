"use strict";!function(){function t(t){return t.frequency=+t.frequency,t.year=+t.year,t}var e=window.d3,r={top:20,right:20,bottom:30,left:40},a=760-r.left-r.right,n=250-r.top-r.bottom,o=e.scale.linear().range([n,0]),i=e.svg.axis().scale(o).orient("left"),c=e.select("body").append("svg").attr("class","chart").attr("width",a+r.left+r.right).attr("height",n+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")"),s=function(t){return""+t.year},d=function(t,e,r,a){var n=250,o="\n                M 0,"+a+" "+e+","+a+"\n                C "+e+","+a+" "+e+","+(a+r)+" "+e+","+(a+r)+"\n                l -"+e+",0\n                C 0,"+(a+r)+" 0,"+a+" 0,"+a+"\n                Z",i=.25*e,c="\n                M 0,"+a+" "+e+","+a+"\n                C "+(e+i)+","+(a+.3*r)+" "+(e+i)+","+(a+.7*r)+" "+e+","+(a+r)+"\n                l -"+e+",0\n                C "+(0-i)+","+(a+.7*r)+" "+(0-i)+","+(a+.3*r)+" 0,"+a+"\n                Z",s="\n                M 0,0 "+e+",0\n                C "+e+",0 "+e+",1 "+e+",1\n                l -"+e+",0\n                C 0,1 0,0 0,0\n                Z";return t.append("path").attr("class","bulge").attr("d",o).transition().delay(0).duration(n).attr("d",c).transition().duration(n).ease("elastic").attr("d",o).transition().ease("cubic-out").duration(1e3).attr("d",s).style("fill-opacity",.5).remove()};window.addChart=function(r,l,u){e.tsv("data/frack-data.tsv",t,function(t,f){if(t)throw t;var y=.2,p=.1,g=e.scale.ordinal().domain(f.map(s)).rangeRoundBands([0,a],p,y),h=e.svg.axis().scale(g).orient("bottom");o.domain([0,e.max(f,function(t){return t.frequency})]),c.append("g").attr("class","x axis").attr("transform","translate(0,"+(n+2)+")").call(h),c.append("g").attr("class","y axis").call(i).append("text").attr("transform","rotate(-90)").attr("y",12).style("text-anchor","end").text("Frequency"),c.selectAll(".bar").data(f).enter().append("g").attr("transform",function(t){return"translate("+g(s(t))+",0)"}).attr("class","bar").on("mouseover",l).on("mousedown",l).on("mouseup",u);var m=c.selectAll(".bar"),x=function(t){return n-o(t.frequency)},w=function(t){return o(t.frequency)};m.append("rect").attr("width",g.rangeBand()).attr("y",n).attr("height",0).transition().duration(300).delay(function(t,e){return 1e3*e}).attr("y",w).attr("height",x).each("end",function(t){var a=e.select(this.parentNode);d(a,g.rangeBand(),x(t),w(t)),a.transition().delay(400).attr("class","bar emptied").each("end",function(t){r(t)})}),m.append("text").text(function(t){return t.frequency}).attr("x",function(){var t=this.getBBox().width;return g.rangeBand()/2-t/2}).attr("y",function(t){var e=this.getBBox().height;return o(t.frequency)-e}).attr("dy",".75em")})}}(),function(){var t=window.mapboxgl,e=window.d3,r=window.addChart;t.accessToken="pk.eyJ1IjoidGVjaGllc2hhcmsiLCJhIjoiY2lrcTUxZmJvMTkweHRubTZlOGt5MnZzeiJ9.CxxVSVIPSsgFFL3Dx-QTbA";var a=new t.Map({container:"map",style:"mapbox://styles/techieshark/cikw6xfu100d098kmu3ogo74t",center:[-94.5,35],zoom:3});window.mapboxMap=a,a.on("style.load",function(){var t="./data/Fracking_Calendar.geojson";e.json(t,function(e,n){return e?void console.error("Error acquiring map data source "+t+": "+e):(n.features=n.features.map(function(t){return t.properties.year=new Date(t.properties["Full Date"]).getFullYear(),t}),a.addSource("locations",{type:"geojson",data:n}),a.addLayer({id:"points",type:"circle",source:"locations",paint:{"circle-radius":5,"circle-color":"DarkSlateGray"}}),a.addLayer({id:"featuredBorder",type:"circle",source:"locations",paint:{"circle-radius":7,"circle-color":"Gold"}}),a.addLayer({id:"featured",type:"circle",source:"locations",paint:{"circle-radius":5,"circle-color":"black"}}),a.setFilter("points",["<","year",2e3]),a.setFilter("featured",["==","year",0]),a.setFilter("featuredBorder",["==","year",0]),void r(function(t){console.log("emptied bar for year "+t.year),a.setFilter("points",["<=","year",t.year]),a.setFilter("featured",["==","year",t.year]),a.setFilter("featuredBorder",["==","year",t.year])},function(t){a.setFilter("featured",["==","year",t.year]),a.setFilter("featuredBorder",["==","year",t.year])},function(){a.setFilter("featured",["==","year",0]),a.setFilter("featuredBorder",["==","year",0])}))})})}();