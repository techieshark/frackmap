"use strict";!function(){function t(t){return t.frequency=+t.frequency,t.year=+t.year,t}var e=window.d3,r=function(t){this.container=t.container||"body",this.totalWidth=t.width||760,this.totalHeight=t.height||250,this.barBulgeEndCallback=t.barBulgeEndCallback||function(){},this.barEmptiedCallback=t.barEmptiedCallback||function(){},this.barMouseDownCallback=t.barMouseDownCallback||function(){},this.barMouseUpCallback=t.barMouseUpCallback||function(){};var r={top:20,right:20,bottom:30,left:40};this.margin=r,this.width=this.totalWidth-r.left-r.right,this.height=this.totalHeight-r.top-r.bottom,this.y=e.scale.linear().range([this.height,0]),this.yAxis=e.svg.axis().scale(this.y).orient("left"),this.render()};window.Chart=r,r.prototype.render=function(){this.svgContainer=e.select(this.container).append("svg").attr("class","chart").attr("width",this.totalWidth).attr("height",this.totalHeight),this.svg=this.svgContainer.append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.buildChart()};var a=function(t){return""+t.year};r.prototype.bulgeBar=function(t,e){var r=250,a=this,n=this.x3.rangeBand(),i=this.getBarHeight(e),o=this.getBarTopY(e),s="\n                M 0,"+o+" "+n+","+o+"\n                C "+n+","+o+" "+n+","+(o+i)+" "+n+","+(o+i)+"\n                l -"+n+",0\n                C 0,"+(o+i)+" 0,"+o+" 0,"+o+"\n                Z",c=.25*n,l="\n                M 0,"+o+" "+n+","+o+"\n                C "+(n+c)+","+(o+.3*i)+" "+(n+c)+","+(o+.7*i)+" "+n+","+(o+i)+"\n                l -"+n+",0\n                C "+(0-c)+","+(o+.7*i)+" "+(0-c)+","+(o+.3*i)+" 0,"+o+"\n                Z";return t.append("path").attr("class","bulge").attr("d",s).transition().delay(0).duration(r).attr("d",l).each("end",function(){a.barBulgeEndCallback(e)}).transition().duration(r).ease("elastic").attr("d",s).remove()},r.prototype.buildChart=function(){var r=this.svg,n=this.y,i=this.yAxis,o=this.height,s=this.barMouseDownCallback,c=this.barMouseUpCallback,l=this.barEmptiedCallback,u=this;e.tsv("data/frack-data.tsv",t,function(t,d){if(t)throw t;u.data=d;var h=.2,y=.1,p=u.x3=e.scale.ordinal().domain(d.map(a)).rangeRoundBands([0,u.width],y,h),f=e.svg.axis().scale(p).orient("bottom");n.domain([0,e.max(d,function(t){return t.frequency})]),r.append("g").attr("class","x axis").attr("transform","translate(0,"+(o+2)+")").call(f),r.append("g").attr("class","y axis").call(i).append("text").attr("transform","rotate(-90)").attr("y",12).style("text-anchor","end").text("Frequency"),r.selectAll(".bar").data(d).enter().append("g").attr("transform",function(t){return"translate("+p(a(t))+",0)"}).attr("class","bar").on("mouseover",s).on("mousedown",s).on("mouseup",c);var g=r.selectAll(".bar"),b=function(t){return o-n(t.frequency)},m=function(t){return n(t.frequency)};g.append("rect").attr("width",p.rangeBand()).attr("y",o).attr("height",0).transition().duration(300).delay(function(t,e){return 1e3*e}).attr("y",m).attr("height",b).each("end",function(t){var r=e.select(this.parentNode);u.bulgeBar(r,t),r.transition().delay(400).attr("class","bar emptied").each("end",function(t){l(t)})}),g.append("text").text(function(t){return t.frequency}).attr("x",function(){var t=this.getBBox().width;return p.rangeBand()/2-t/2}).attr("y",function(t){var e=this.getBBox().height;return n(t.frequency)-e}).attr("dy",".75em")})},r.prototype.getBarTopY=function(t){return this.y(t.frequency)},r.prototype.getBarCenterX=function(t){return this.x3(t.year)+this.x3.rangeBand()/2},r.prototype.getBarHeight=function(t){return this.height-this.y(t.frequency)}}(),function(){var t=window.mapboxgl,e=window.d3,r=window._,a=window.$,n=window.Chart;t.accessToken="pk.eyJ1IjoidGVjaGllc2hhcmsiLCJhIjoiY2lrcTUxZmJvMTkweHRubTZlOGt5MnZzeiJ9.CxxVSVIPSsgFFL3Dx-QTbA";var i=new t.Map({container:"map",style:"mapbox://styles/techieshark/cikw6xfu100d098kmu3ogo74t",center:[-94.5,35],zoom:3});window.mapboxMap=i,i.on("style.load",function(){var t="./data/Fracking_Calendar.geojson";e.json(t,function(e,o){if(e)return void console.error("Error acquiring map data source "+t+": "+e);o.features=o.features.map(function(t){return t.properties.year=new Date(t.properties["Full Date"]).getFullYear(),t}),i.addSource("locations",{type:"geojson",data:o}),i.addLayer({id:"points",type:"circle",source:"locations",paint:{"circle-radius":5,"circle-color":"DarkSlateGray"}}),i.addLayer({id:"featuredBorder",type:"circle",source:"locations",paint:{"circle-radius":7,"circle-color":"red"}}),i.addLayer({id:"featured",type:"circle",source:"locations",paint:{"circle-radius":5,"circle-color":"black"}}),i.setFilter("points",["<","year",2e3]),i.setFilter("featured",["==","year",0]),i.setFilter("featuredBorder",["==","year",0]);var s,c=function(t){console.log("emptied bar for year "+t.year),i.setFilter("points",["<","year",t.year]);var e=r.filter(o.features,function(e){return e.properties.year===t.year}),n=r.map(e,function(t){var e=i.project(t.geometry.coordinates);return e.x=e.x-s.margin.left,e.y=e.y-s.margin.top-a(s.svgContainer[0][0]).offset().top,e}),c={x:s.getBarCenterX(t),y:s.getBarTopY(t)},l=s.svg.selectAll("circle.y-"+t.year).data(n).enter().append("circle"),u=0;l.attr("class","y-"+t.year).attr("cx",c.x).attr("cy",c.y).attr("r",5).transition().delay(function(t,e){return 100*e}).duration(1e3).ease("ease-out").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).each("start",function(){u++}).each("end",function(){0===--u&&(i.setFilter("featured",["==","year",t.year]),i.setFilter("featuredBorder",["==","year",t.year]),l.remove())})},l=function(t){i.setFilter("featured",["==","year",t.year]),i.setFilter("featuredBorder",["==","year",t.year])},u=function(){i.setFilter("featured",["==","year",0]),i.setFilter("featuredBorder",["==","year",0])};s=new n({barBulgeEndCallback:c,barMouseDownCallback:l,barMouseUpCallback:u})})})}();