"use strict";function type(t){return t.frequency=+t.frequency,t.year=+t.year,t}var d3=window.d3,margin={top:20,right:20,bottom:30,left:40},width=760-margin.left-margin.right,height=500-margin.top-margin.bottom,y=d3.scale.linear().range([height,0]),yAxis=d3.svg.axis().scale(y).orient("left"),svg=d3.select("body").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),getYear=function(t){return""+t.year},bulgeBar=function(t,a,r,n){var e=250,i="\n                M 0,"+n+" "+a+","+n+"\n                C "+a+","+n+" "+a+","+(n+r)+" "+a+","+(n+r)+"\n                l -"+a+",0\n                C 0,"+(n+r)+" 0,"+n+" 0,"+n+"\n                Z",s=.25*a,o="\n                M 0,"+n+" "+a+","+n+"\n                C "+(a+s)+","+(n+.3*r)+" "+(a+s)+","+(n+.7*r)+" "+a+","+(n+r)+"\n                l -"+a+",0\n                C "+(0-s)+","+(n+.7*r)+" "+(0-s)+","+(n+.3*r)+" 0,"+n+"\n                Z",d="\n                M 0,0 "+a+",0\n                C "+a+",0 "+a+",1 "+a+",1\n                l -"+a+",0\n                C 0,1 0,0 0,0\n                Z";return t.append("path").attr("class","bulge").attr("d",i).transition().delay(0).duration(e).attr("d",o).transition().duration(e).ease("elastic").attr("d",i).transition().ease("cubic-out").duration(250).attr("d",d).style("fill-opacity",.5).remove()};d3.tsv("frack-data.tsv",type,function(t,a){if(t)throw t;var r=.2,n=.1,e=d3.scale.ordinal().domain(a.map(getYear)).rangeRoundBands([0,width],n,r),i=d3.svg.axis().scale(e).orient("bottom");y.domain([0,d3.max(a,function(t){return t.frequency})]),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(height+2)+")").call(i),svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",12).style("text-anchor","end").text("Frequency"),svg.selectAll(".bar").data(a).enter().append("g").attr("transform",function(t){return"translate("+e(getYear(t))+",0)"}).attr("class","bar");var s=svg.selectAll(".bar"),o=function(t){return height-y(t.frequency)},d=function(t){return y(t.frequency)};s.append("rect").attr("width",e.rangeBand()).attr("y",height).attr("height",0).transition().duration(300).delay(function(t,a){return 500*a}).attr("y",d).attr("height",o).each("end",function(t){var a=d3.select(this.parentNode);bulgeBar(a,e.rangeBand(),o(t),d(t)),a.transition().delay(200).attr("class","bar emptied")}),s.append("text").text(function(t){return t.frequency}).attr("x",function(){var t=this.getBBox().width;return e.rangeBand()/2-t/2}).attr("y",function(t){var a=this.getBBox().height;return y(t.frequency)-a}).attr("dy",".75em")});