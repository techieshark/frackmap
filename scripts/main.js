"use strict";!function(){function t(t){return t.frequency=+t.frequency,t.year=+t.year,t}var e=window.d3,r=function(t){this.container=t.container||"body",this.totalWidth=t.width||760,this.totalHeight=t.height||250,this.barEmptiedCallback=t.barEmptiedCallback||function(){},this.barMouseDownCallback=t.barMouseDownCallback||function(){},this.barMouseUpCallback=t.barMouseUpCallback||function(){};var r={top:20,right:20,bottom:30,left:40};this.margin=r,this.width=this.totalWidth-r.left-r.right,this.height=this.totalHeight-r.top-r.bottom,this.y=e.scale.linear().range([this.height,0]),this.yAxis=e.svg.axis().scale(this.y).orient("left"),this.render()};window.Chart=r,r.prototype.render=function(){this.svgContainer=e.select(this.container).append("svg").attr("class","chart").attr("width",this.totalWidth).attr("height",this.totalHeight),this.svg=this.svgContainer.append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.buildChart()};var a=function(t){return""+t.year},n=function(t,e,r,a){var n=250,i="\n                M 0,"+a+" "+e+","+a+"\n                C "+e+","+a+" "+e+","+(a+r)+" "+e+","+(a+r)+"\n                l -"+e+",0\n                C 0,"+(a+r)+" 0,"+a+" 0,"+a+"\n                Z",o=.25*e,s="\n                M 0,"+a+" "+e+","+a+"\n                C "+(e+o)+","+(a+.3*r)+" "+(e+o)+","+(a+.7*r)+" "+e+","+(a+r)+"\n                l -"+e+",0\n                C "+(0-o)+","+(a+.7*r)+" "+(0-o)+","+(a+.3*r)+" 0,"+a+"\n                Z";return t.append("path").attr("class","bulge").attr("d",i).transition().delay(0).duration(n).attr("d",s).transition().duration(n).ease("elastic").attr("d",i).remove()};r.prototype.buildChart=function(){var r=this.svg,i=this.y,o=this.yAxis,s=this.height,c=this.barMouseDownCallback,l=this.barMouseUpCallback,u=this.barEmptiedCallback,d=this;e.tsv("data/frack-data.tsv",t,function(t,h){if(t)throw t;d.data=h;var y=.2,p=.1,f=d.x3=e.scale.ordinal().domain(h.map(a)).rangeRoundBands([0,d.width],p,y),g=e.svg.axis().scale(f).orient("bottom");i.domain([0,e.max(h,function(t){return t.frequency})]),r.append("g").attr("class","x axis").attr("transform","translate(0,"+(s+2)+")").call(g),r.append("g").attr("class","y axis").call(o).append("text").attr("transform","rotate(-90)").attr("y",12).style("text-anchor","end").text("Frequency"),r.selectAll(".bar").data(h).enter().append("g").attr("transform",function(t){return"translate("+f(a(t))+",0)"}).attr("class","bar").on("mouseover",c).on("mousedown",c).on("mouseup",l);var b=r.selectAll(".bar"),m=function(t){return s-i(t.frequency)},x=function(t){return i(t.frequency)};b.append("rect").attr("width",f.rangeBand()).attr("y",s).attr("height",0).transition().duration(300).delay(function(t,e){return 1e3*e}).attr("y",x).attr("height",m).each("end",function(t){var r=e.select(this.parentNode);n(r,f.rangeBand(),m(t),x(t)),r.transition().delay(400).attr("class","bar emptied").each("end",function(t){u(t)})}),b.append("text").text(function(t){return t.frequency}).attr("x",function(){var t=this.getBBox().width;return f.rangeBand()/2-t/2}).attr("y",function(t){var e=this.getBBox().height;return i(t.frequency)-e}).attr("dy",".75em")})},r.prototype.getBarTopY=function(t){return this.y(t.frequency)},r.prototype.getBarCenterX=function(t){return this.x3(t.year)+this.x3.rangeBand()/2}}(),function(){var t=window.mapboxgl,e=window.d3,r=window._,a=window.$,n=window.Chart;t.accessToken="pk.eyJ1IjoidGVjaGllc2hhcmsiLCJhIjoiY2lrcTUxZmJvMTkweHRubTZlOGt5MnZzeiJ9.CxxVSVIPSsgFFL3Dx-QTbA";var i=new t.Map({container:"map",style:"mapbox://styles/techieshark/cikw6xfu100d098kmu3ogo74t",center:[-94.5,35],zoom:3});window.mapboxMap=i,i.on("style.load",function(){var t="./data/Fracking_Calendar.geojson";e.json(t,function(e,o){if(e)return void console.error("Error acquiring map data source "+t+": "+e);o.features=o.features.map(function(t){return t.properties.year=new Date(t.properties["Full Date"]).getFullYear(),t}),i.addSource("locations",{type:"geojson",data:o}),i.addLayer({id:"points",type:"circle",source:"locations",paint:{"circle-radius":5,"circle-color":"DarkSlateGray"}}),i.addLayer({id:"featuredBorder",type:"circle",source:"locations",paint:{"circle-radius":7,"circle-color":"red"}}),i.addLayer({id:"featured",type:"circle",source:"locations",paint:{"circle-radius":5,"circle-color":"black"}}),i.setFilter("points",["<","year",2e3]),i.setFilter("featured",["==","year",0]),i.setFilter("featuredBorder",["==","year",0]);var s,c=function(t){console.log("emptied bar for year "+t.year),i.setFilter("points",["<","year",t.year]);var e=r.filter(o.features,function(e){return e.properties.year===t.year}),n=r.map(e,function(t){var e=i.project(t.geometry.coordinates);return e.x=e.x-s.margin.left,e.y=e.y-s.margin.top-a(s.svgContainer[0][0]).offset().top,e}),c={x:s.getBarCenterX(t),y:s.getBarTopY(t)},l=s.svg.selectAll("circle.y-"+t.year).data(n).enter().append("circle"),u=0;l.attr("class","y-"+t.year).attr("cx",c.x).attr("cy",c.y).attr("r",5).transition().duration(1e3).ease("ease-out").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).each("start",function(){u++}).each("end",function(){0===--u&&(i.setFilter("featured",["==","year",t.year]),i.setFilter("featuredBorder",["==","year",t.year]),l.remove())})},l=function(t){i.setFilter("featured",["==","year",t.year]),i.setFilter("featuredBorder",["==","year",t.year])},u=function(){i.setFilter("featured",["==","year",0]),i.setFilter("featuredBorder",["==","year",0])};s=new n({barEmptiedCallback:c,barMouseDownCallback:l,barMouseUpCallback:u})})})}();