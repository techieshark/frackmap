"use strict";!function(){function t(t){return t.frequency=+t.frequency,t.year=+t.year,t}var e=window.d3,a={top:20,right:20,bottom:30,left:40},r=760-a.left-a.right,n=300-a.top-a.bottom,o=e.scale.linear().range([n,0]),i=e.svg.axis().scale(o).orient("left"),c=e.select("body").append("svg").attr("width",r+a.left+a.right).attr("height",n+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),s=function(t){return""+t.year},d=function(t,e,a,r){var n=250,o="\n                M 0,"+r+" "+e+","+r+"\n                C "+e+","+r+" "+e+","+(r+a)+" "+e+","+(r+a)+"\n                l -"+e+",0\n                C 0,"+(r+a)+" 0,"+r+" 0,"+r+"\n                Z",i=.25*e,c="\n                M 0,"+r+" "+e+","+r+"\n                C "+(e+i)+","+(r+.3*a)+" "+(e+i)+","+(r+.7*a)+" "+e+","+(r+a)+"\n                l -"+e+",0\n                C "+(0-i)+","+(r+.7*a)+" "+(0-i)+","+(r+.3*a)+" 0,"+r+"\n                Z",s="\n                M 0,0 "+e+",0\n                C "+e+",0 "+e+",1 "+e+",1\n                l -"+e+",0\n                C 0,1 0,0 0,0\n                Z";return t.append("path").attr("class","bulge").attr("d",o).transition().delay(0).duration(n).attr("d",c).transition().duration(n).ease("elastic").attr("d",o).transition().ease("cubic-out").duration(1e3).attr("d",s).style("fill-opacity",.5).remove()};window.addChart=function(a){e.tsv("data/frack-data.tsv",t,function(t,l){if(t)throw t;var u=.2,p=.1,f=e.scale.ordinal().domain(l.map(s)).rangeRoundBands([0,r],p,u),y=e.svg.axis().scale(f).orient("bottom");o.domain([0,e.max(l,function(t){return t.frequency})]),c.append("g").attr("class","x axis").attr("transform","translate(0,"+(n+2)+")").call(y),c.append("g").attr("class","y axis").call(i).append("text").attr("transform","rotate(-90)").attr("y",12).style("text-anchor","end").text("Frequency"),c.selectAll(".bar").data(l).enter().append("g").attr("transform",function(t){return"translate("+f(s(t))+",0)"}).attr("class","bar");var g=c.selectAll(".bar"),h=function(t){return n-o(t.frequency)},m=function(t){return o(t.frequency)};g.append("rect").attr("width",f.rangeBand()).attr("y",n).attr("height",0).transition().duration(300).delay(function(t,e){return 1e3*e}).attr("y",m).attr("height",h).each("end",function(t){var r=e.select(this.parentNode);d(r,f.rangeBand(),h(t),m(t)),r.transition().delay(400).attr("class","bar emptied").each("end",function(t){a(t)})}),g.append("text").text(function(t){return t.frequency}).attr("x",function(){var t=this.getBBox().width;return f.rangeBand()/2-t/2}).attr("y",function(t){var e=this.getBBox().height;return o(t.frequency)-e}).attr("dy",".75em")})}}(),function(){var t=window.mapboxgl,e=window.d3,a=window.addChart;t.accessToken="pk.eyJ1IjoidGVjaGllc2hhcmsiLCJhIjoiY2lrcTUxZmJvMTkweHRubTZlOGt5MnZzeiJ9.CxxVSVIPSsgFFL3Dx-QTbA";var r=new t.Map({container:"map",style:"mapbox://styles/techieshark/cikw6xfu100d098kmu3ogo74t",center:[-94.5,40],zoom:3});r.on("style.load",function(){var t="/data/Fracking_Calendar.geojson";e.json(t,function(e,n){return e?void console.error("Error acquiring map data source "+t+": "+e):(n.features=n.features.map(function(t){return t.properties.year=new Date(t.properties["Full Date"]).getFullYear(),t}),r.addSource("locations",{type:"geojson",data:n}),r.addLayer({id:"points",type:"circle",source:"locations",paint:{"circle-radius":5,"circle-color":"rgba(55,148,179,0.8)"}}),r.setFilter("points",["<","year",2e3]),void a(function(t){console.log("emptied bar for year "+t.year),r.setFilter("points",["<=","year",t.year])}))})})}();